/**
 * yii2-dynamic-form
 *
 * A jQuery plugin to clone form elements in a nested manner, maintaining accessibility.
 *
 * @author Wanderson Bragan√ßa <wanderson.wbc@gmail.com>
 */
!function($){var pluginName="yiiDynamicForm";$.fn.yiiDynamicForm=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?($.error("Method "+e+" does not exist on jQuery.yiiDynamicForm"),!1):methods.init.apply(this,arguments)};var events={beforeClone:"beforeClone",afterClone:"afterClone",limitReached:"limitReached",afterRemove:"afterRemove"},defaults={limit:999,min:1,dynamicItems:".dynamic-items",dynamicItem:".dynamic-item",cloneButton:".clone",deleteButton:".delete",clonePosition:"after",template:!1},regex=/(.*-)(\d)(-.*)/i,methods={init:function(e){return this.each(function(){var t=$(this),i=t.data(pluginName);if(!i){var n=$.extend({},defaults,e||{});t.data(pluginName,{target:t,settings:n}),t.find(n.cloneButton).length&&t.on("click",n.cloneButton,function(e){e.preventDefault(),t.triggerHandler(events.beforeClone,[$(this)]),startClone(e,$(this),t)}),t.on("click",n.deleteButton,function(e){e.preventDefault(),removeItem(t,$(this))})}})},updateContainer:function(){var e=$(this);redoIDs(e),restoreSpecialJs(e),fixFormValidaton(e)}},startClone=function(e,t,i){var n=i.data(pluginName).settings,a=i.find(n.dynamicItem).length;a<n.limit?($toclone=$($(n.template).html()),$newclone=$toclone.clone(!1,!1),$newclone.find("input, textarea, select").each(function(){$(this).val("")}),"after"!=n.clonePosition?$(n.dynamicItems).prepend($newclone):$(n.dynamicItems).append($newclone),redoIDs(i),removeErrorCssClass($newclone),restoreSpecialJs(i),fixFormValidaton(i),i.triggerHandler(events.afterClone,$newclone)):i.triggerHandler(events.limitReached,n.limit)},fixFormValidaton=function(e){var t=e.data(pluginName).settings;$(t.dynamicItem).each(function(e){t.fields.forEach(function(i){var n=i.id.replace("{}",e),a=$("#"+t.formId).yiiActiveForm("find",i.id.replace("{}",0));void 0!==a&&(a=$.extend(!0,{},a),a.id=n,a.container=".field-"+n,a.input="#"+n,a.name=i.name.replace("{}",e),a.value=$("#"+n).val(),a.status=0,"undefined"!==$("#"+t.formId).yiiActiveForm("find",n)&&$("#"+t.formId).yiiActiveForm("remove",n),$("#"+t.formId).yiiActiveForm("add",a))})})},removeItem=function(e,t){var i=e.data(pluginName).settings,n=e.find(i.dynamicItem).length;n>i.min&&($todelete=t.closest(i.dynamicItem),$todelete.remove(),redoIDs(e),restoreSpecialJs(e),fixFormValidaton(e),e.triggerHandler(events.afterRemove))},removeErrorCssClass=function(e){e.find(".has-success").each(function(){$(this).removeClass("has-success")}),e.find(".has-error").each(function(){$(this).removeClass("has-error")})},restoreSpecialJs=function($container){var config=$container.data(pluginName).settings,$hasDatepicker=$(config.dynamicItems).find("[data-plugin-name=datepicker]");$hasDatepicker.length>0&&$hasDatepicker.each(function(){$(this).parent().removeData().datepicker("remove"),$(this).parent().datepicker($(this).attr("data-plugin-options"))});var $hasMaskmoney=$(config.dynamicItems).find("[data-plugin-name=maskMoney]");$hasMaskmoney.length>0&&$hasMaskmoney.each(function(){$(this).parent().find("input").removeData().off();var id="#"+$(this).attr("id"),displayID=id+"-disp";$(displayID).maskMoney("destroy"),$(displayID).maskMoney(eval($(this).attr("data-plugin-options"))),$(displayID).maskMoney("mask",parseFloat($(displayID).val())),$(displayID).on("change",function(){var e=$(displayID).maskMoney("unmasked")[0];$(id).val(e),$(id).trigger("change")})});var $hasFileinput=$(config.dynamicItems).find("[data-plugin-name=fileinput]");$hasFileinput.length>0&&$hasFileinput.each(function(){$(this).fileinput(eval($(this).attr("data-plugin-options")))});var $hasTouchSpin=$(config.dynamicItems).find("[data-plugin-name=TouchSpin]");$hasTouchSpin.length>0&&$hasTouchSpin.each(function(){$(this).TouchSpin("destroy"),$(this).TouchSpin(eval($(this).attr("data-plugin-options")))})},redoIDs=function(e){var t=e.data(pluginName).settings;e.find(t.dynamicItem).each(function(e){var t=e,i=$(this);$(this).find("*").each(function(){var n=$(this).attr("id");if(n){var a=n,o=n.match(regex);o&&4===o.length?(a=o[1]+e+o[3],$(this).attr("id",a)):(a=n+e,$(this).attr("id",a)),n!==a&&i.find(".field-"+n).each(function(){$(this).removeClass("field-"+n).addClass("field-"+a)})}var r=$(this).attr("for");if(r){var o=r.match(regex);o&&4===o.length?$(this).attr("for",o[1]+e+o[3]):$(this).attr("for",r+e)}var s=$(this).attr("name");if(s){var c=s.match(/\[([^}]+)\]/);if(c&&c.length>=1){var l=s;s=[].map.call(l,function(e,i){return isNaN(+e)||"["!==l[i-1]||"]"!==l[i+1]?e:t}).join(""),$(this).attr("name",s)}}})})}}(window.jQuery);
